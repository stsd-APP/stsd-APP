/**
 * æš´åŠ›åˆ‡æ¢ SQLite è„šæœ¬
 * ä½œç”¨ï¼šç›´æ¥è¦†ç›– prisma é…ç½®æ–‡ä»¶ï¼Œç¡®ä¿ 100% æ­£ç¡®
 */
const fs = require('fs');
const path = require('path');

// 1. å®šä¹‰æ­£ç¡®çš„ schema.prisma å†…å®¹ (SQLiteç‰ˆ)
const schemaContent = `
generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

// ç”¨æˆ·æ¨¡å‹
model User {
  id        String   @id @default(uuid())
  username  String   @unique
  password  String
  createdAt DateTime @default(now())
}

// åŒ…è£¹æ¨¡å‹
model Package {
  id        String   @id @default(uuid())
  tracking  String   @unique
  name      String
  status    String
  userId    String
  createdAt DateTime @default(now())
}

// ä»£ä»˜è®¢å•æ¨¡å‹ (ä½ åˆšæ‰åŠ çš„)
model ProxyOrder {
  id        String   @id @default(uuid())
  userId    String
  url       String
  amount    Decimal
  status    String   @default("PENDING") // å¾…å¤„ç†
  createdAt DateTime @default(now())
}
`;

// 2. å®šä¹‰æ­£ç¡®çš„ .env å†…å®¹
const envContent = `DATABASE_URL="file:./dev.db"`;

// 3. å†™å…¥æ–‡ä»¶
const dbPath = path.join(__dirname, 'packages/database');
const prismaPath = path.join(dbPath, 'prisma');

// ç¡®ä¿ç›®å½•å­˜åœ¨
if (!fs.existsSync(prismaPath)) {
  fs.mkdirSync(prismaPath, { recursive: true });
}

console.log('ğŸ”„ æ­£åœ¨é‡å†™æ•°æ®åº“é…ç½®...');
fs.writeFileSync(path.join(prismaPath, 'schema.prisma'), schemaContent);
fs.writeFileSync(path.join(dbPath, '.env'), envContent);

// åˆ é™¤å¯èƒ½å­˜åœ¨çš„æ—§è¿ç§»æ–‡ä»¶å¤¹ (é˜²æ­¢å†²çª)
const migrationPath = path.join(prismaPath, 'migrations');
if (fs.existsSync(migrationPath)) {
    fs.rmSync(migrationPath, { recursive: true, force: true });
    console.log('ğŸ—‘ï¸  å·²æ¸…ç†æ—§çš„è¿ç§»æ–‡ä»¶');
}

console.log('âœ… æ•°æ®åº“å·²å¼ºåˆ¶åˆ‡æ¢ä¸º SQLite æ¨¡å¼ï¼');
console.log('ğŸ‘‰ è¯·ç«‹å³æ‰§è¡Œä¸‹ä¸€æ­¥å‘½ä»¤ã€‚');
`;

---

### ç¬¬äºŒæ­¥ï¼šè¿è¡Œè¿™ä¸ªè„šæœ¬

åœ¨ç»ˆç«¯è¾“å…¥ï¼š

```powershell
node force_sqlite.js